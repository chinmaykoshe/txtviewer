<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enterprise Text File Viewer</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1e1e1e;
    color: #ddd;
    height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background 0.3s, color 0.3s;
  }

  body.dark {
    background: #1e1e1e;
    color: #ddd;
  }

  body.dark .navbar { background-color: #0d1a2b; color: #fff; }
  body.dark .sidebar { background: #2c2c2c; border-right: 1px solid #444; }
  body.dark .sidebar button { background: #444; color: #fff; }
  body.dark .sidebar button:hover { background: #666; }
  body.dark .content { background: #1b1b1b; border-left: 1px solid #444; color: #ddd; }

  .navbar {
    background-color: #0d1a2b;
    color: #fff;
    padding: 15px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .navbar h1 { font-size: 20px; }

  button.emoji-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 22px;
    margin-left: 10px;
    transition: transform 0.2s;
  }
  button.emoji-btn:hover { transform: scale(1.2); }

  .main { flex: 1; display: flex; overflow: hidden; }

  .sidebar {
    width: 250px;
    background: #2c2c2c;
    border-right: 1px solid #444;
    overflow-y: auto;
    padding: 15px;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #fileSearch, #fileUpload {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #666;
    background: #444;
    color: #ddd;
  }

  #uploadBtn {
    padding: 8px 10px;
    border-radius: 5px;
    border: none;
    background: #ff8c00;
    color: #fff;
    cursor: pointer;
  }
  #uploadBtn:hover { background: #e57c00; }

  .sidebar button.file-btn {
    width: 100%;
    background: #444;
    border: none;
    color: #fff;
    padding: 10px 15px;
    margin-bottom: 5px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 15px;
    text-align: left;
    transition: all 0.2s ease;
  }
  .sidebar button.file-btn:hover { background: #666; }

  .content {
    flex: 1;
    padding: 20px;
    background: #1b1b1b;
    overflow-y: auto;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    border-left: 1px solid #444;
    position: relative;
  }

  #contentSearch {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 200px;
    padding: 6px 10px;
    border-radius: 5px;
    border: 1px solid #666;
    display: none;
    z-index: 1;
    background: #333;
    color: #ddd;
  }

  #fileList, #content { color: #ddd; font-style: italic; }

  @media (max-width: 768px) {
    .main { flex-direction: column; }
    .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid #444; }
    .content { border-left: none; }
  }

  mark { background: yellow; color: black; }
</style>
</head>
<body class="dark">

<div class="navbar">
  <div style="display:flex;align-items:center;gap:10px;">
    <button id="backBtn" class="emoji-btn" title="Back">‚óÄ</button>
    <h1>Text File Viewer</h1>
    <button id="fileSearchToggle" class="emoji-btn" title="Search in file">üîç</button>
  </div>
  <button id="darkModeToggle" class="emoji-btn" title="Toggle Dark/Light Mode">‚òÄÔ∏è</button>
</div>

<div class="main">
  <div class="sidebar">
    <input type="text" id="fileSearch" placeholder="Search files...">
    <input type="file" id="fileUpload" accept=".txt">
    <button id="uploadBtn">‚ûï Upload</button>
    <div id="fileList">Loading files...</div>
  </div>
  <div class="content">
    <input type="text" id="contentSearch" placeholder="Search in file...">
    <div id="content"></div>
  </div>
</div>

<script>
const fileListDiv = document.getElementById('fileList');
const contentDiv = document.getElementById('content');
const backBtn = document.getElementById('backBtn');
const fileSearch = document.getElementById('fileSearch');
const contentSearch = document.getElementById('contentSearch');
const fileSearchToggle = document.getElementById('fileSearchToggle');
const darkModeToggle = document.getElementById('darkModeToggle');
const fileUpload = document.getElementById('fileUpload');
const uploadBtn = document.getElementById('uploadBtn');

let filesArray = [];
let currentFileContent = "";

// Fetch list of files
function loadFiles() {
  fetch('/files')
    .then(res => res.json())
    .then(files => {
      filesArray = files;
      displayFiles(filesArray);
    });
}

function displayFiles(files) {
  if (!files.length) {
    fileListDiv.textContent = 'No text files found';
    return;
  }
  fileListDiv.innerHTML = '';
  files.forEach(file => {
    const btn = document.createElement('button');
    btn.textContent = file;
    btn.classList.add('file-btn');
    btn.onclick = () => showFile(file);
    fileListDiv.appendChild(btn);
  });
}

// Show file content
function showFile(fileName) {
  fetch('/file/' + fileName)
    .then(res => res.text())
    .then(data => {
      currentFileContent = data;
      contentDiv.textContent = data;
      fileListDiv.parentElement.style.display = 'none';
      backBtn.style.display = 'inline-block';
      contentSearch.style.display = 'none';
      contentSearch.value = '';
    });
}

// Back button
backBtn.onclick = () => {
  contentDiv.textContent = '';
  backBtn.style.display = 'none';
  fileListDiv.parentElement.style.display = 'flex';
  contentSearch.style.display = 'none';
}

// Dark mode toggle
darkModeToggle.onclick = () => {
  document.body.classList.toggle('dark');
  darkModeToggle.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
}

// File search
fileSearch.addEventListener('input', () => {
  const query = fileSearch.value.toLowerCase();
  displayFiles(filesArray.filter(f => f.toLowerCase().includes(query)));
});

// Floating content search toggle
fileSearchToggle.onclick = () => {
  if(currentFileContent) {
    contentSearch.style.display = contentSearch.style.display === 'block' ? 'none' : 'block';
    contentSearch.focus();
  }
}

// Content search
contentSearch.addEventListener('input', () => {
  const query = contentSearch.value.toLowerCase();
  if (!currentFileContent) return;
  const regex = new RegExp(`(${query})`, 'gi');
  contentDiv.innerHTML = currentFileContent.replace(regex, '<mark>$1</mark>');
});

// Upload file
uploadBtn.onclick = () => {
  if (!fileUpload.files.length) return alert('Select a file first');
  const formData = new FormData();
  formData.append('file', fileUpload.files[0]);

  fetch('/upload', { method: 'POST', body: formData })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert(`File uploaded: ${data.file}`);
        fileUpload.value = '';
        loadFiles();
      }
    })
    .catch(err => alert('Upload failed: ' + err));
}

// Initial load
loadFiles();
</script>

</body>
</html>
